services:
  webapp:
    image: ghcr.io/rrhul0/future-capsule:${IMAGE_TAG}
    container_name: future-capsule-${IMAGE_TAG}
    restart: always
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - AUTH_SECRET=${AUTH_SECRET}
      - AUTH_URL=${AUTH_URL}
      - TZ=${TZ}
      - NEXT_PUBLIC_APP_URL=${NEXT_PUBLIC_APP_URL}
      - GITLAB_ID=${GITLAB_ID}
      - GITLAB_SECRET=${GITLAB_SECRET}
      - GITHUB_ID=${GITHUB_ID}
      - GITHUB_SECRET=${GITHUB_SECRET}
      - GOOGLE_ID=${GOOGLE_ID}
      - GOOGLE_SECRET=${GOOGLE_SECRET}
      - NEXT_PUBLIC_FIREBASE_API_KEY=${NEXT_PUBLIC_FIREBASE_API_KEY}
      - NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=${NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN}
      - NEXT_PUBLIC_FIREBASE_PROJECT_ID=${NEXT_PUBLIC_FIREBASE_PROJECT_ID}
      - NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=${NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET}
      - NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=${NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID}
      - NEXT_PUBLIC_FIREBASE_APP_ID=${NEXT_PUBLIC_FIREBASE_APP_ID}
      - BREVO_USER=${BREVO_USER}
      - BREVO_PASS=${BREVO_PASS}
    networks:
      - traefik
    expose:
      - '3000'
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.${BRANCH_NAME}.entrypoints=websecure'
      - 'traefik.http.routers.${BRANCH_NAME}.rule=Host(`${BRANCH_NAME}.tt.clammy.xyz`)'
      - 'traefik.http.routers.${BRANCH_NAME}.tls.certresolver=myresolver'
      - 'traefik.http.services.${BRANCH_NAME}.loadbalancer.server.port=3000'
networks:
  traefik:
    external: true
    name: traefik
